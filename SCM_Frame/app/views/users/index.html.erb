<h5 class="form-header">User List</h5>

<div class="rt-sec">

	<%= button_to 'Upload', import_path, method: :get , class: "btn btn-success" %>
	
	<%= button_to 'Export', export_path, method: :get , class: "btn btn-success" %>

</div>

<div class="container">

	<table id="example" class='table table-striped table-sm'>

		<thead>

			<th>No</th>

			<th>Name</th>

			<th>Email</th>

			<th>Created User</th>

			<th>Type</th>

			<th>Phone</th>

			<th>Date of birth</th>

			<th>Address</th>

			<th>Created_date</th>

			<th>Updated_date</th>

			<th>Action</th>

		</thead>

		<tbody>

			<% @users.each do |user| %>
				
					<tr>

						<td><%= @add = @add + 1 %></td>
						
						<td>

						<p onclick="confirmViewModal(<%= user.id %>)"><%= user.name %></p>

						<!-- View Modal -->

						<div class="modal fade" id="viewModal<%=user.id%>" tabindex="-1" role="dialog" aria-labelledby="viewModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
								<div class="modal-header">
										<h5 class="modal-title" id="viewModalLabel">User Confirm</h5>
										<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
							
									<%= image_tag(user.userProfile, :alt => "rss feed" , class: 'profile-img' ) %>
								
									<div class="detail">	
									<p>Name: <%= user.name %></p>
										<p>Type:
										<% if user.userType == "0" %>
											<%= "Admin" %>
										<% else %>
											<%= "User" %>
										<% end %>
										</p>
										<p>Email: <%= user.email %></p>
										<p>Phone: <%= user.phone %></p>
										<p>Date of Birth: <%= user.dob.strftime("%Y/%m/%d") %></p>
										<p>Address: <%= user.address %></p>
										<p>Created Date<%= user.created_at.strftime("%Y/%m/%d") %></p>
										<p>Created User:
										<% if @user = User.find_by_id(user.create_user_id) %>
											<%= @user.name %>
										<% else %>
											<%= "-" %>
										<% end %>
										</p>
									<p>Updated Date:<%= user.updated_at.strftime("%Y/%m/%d") %></p>
										<p>Updated User:
										<% if @user = User.find_by_id(user.updated_user_id) %>
											<%= @user.name %>
									<% else %>
										<%= "-" %>
									<% end %>
										</p>
										</div>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" id="stop" data-bs-dismiss="modal">Close</button>
										</div>
								</div>
							</div>
						</div>
						
						</td>

						<td><%= user.email %></td>

						<td>
						<% if @user = User.find_by_id(user.create_user_id) %>
							<%= @user.name %>
						<% else %>
							<%= "-" %>
						<% end %>
						</td>

						<td>
						<% if user.userType == "0" %>
							<%= "Admin" %>
						<% else %>
							<%= "User" %>
						<% end %>
						</td>

						<td><%= user.phone %></td>

						<td><%= user.dob.strftime("%Y/%m/%d") %></td>

						<td><%= user.address %></td>

						<td><%= user.created_at.strftime("%Y/%m/%d") %></td>

						<td><%= user.updated_at.strftime("%Y/%m/%d") %></td>
						
						<td>
						
						<button class="btn btn-danger deletebtn" onclick="confirmDeleteModal(<%=  user.id %>)" >Delete</button>

						<!-- Delete Modal -->
						<div class="modal fade" id="exampleModal<%=user.id%>" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
							<div class="modal-dialog" role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalLabel">Delete Confirm</h5>
										<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<p> Are you sure to delete this user? </p>
										<p>ID: <%= user.id %></p>
										<p>Name: <%= user.name %></p>
										<p>Email: <%= user.email %></p>
										<p>Phone: <%= user.phone %></p>
										<p>Date of Birth: <%= user.dob.strftime("%Y/%m/%d") %></p>
										<p>Address: <%= user.address %></p>
									</div>
									<div class="modal-footer">
										<button type="button" class="btn btn-secondary" id="no" data-bs-dismiss="modal">Cancel</button>
										<%= link_to 'Delete', user_path(user), class:"btn btn-danger sure", method: 'delete' , onclick:"stopModal(#{user.id})" %>
										</div>
								</div>
							</div>
						</div>

						</td>	

						</tr>
			<% end %>

			</tbody>

	</table>

</div>

<script type="text/javascript">

function confirmDeleteModal(id){

  $('#exampleModal'+id).modal('show');

}    

function stopModal(id){
	
	$('#exampleModal'+id).modal('hide');
	
} 
  
function confirmViewModal(id){

  $('#viewModal'+id).modal('show');

} 

</script>